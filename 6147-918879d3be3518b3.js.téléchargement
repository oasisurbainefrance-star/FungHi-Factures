"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6147],{6568:(e,t,n)=>{n.d(t,{ED:()=>o,SL:()=>u,fO:()=>l,n2:()=>a,tA:()=>d});var i=n(96784),r=n(7620);let a=e=>2e3*e.document_asset.page_count,u=e=>Math.min(1600,Math.ceil(e.preview_asset.image_width*e.preview_asset.image_height/700)),o=e=>e.reduce((e,t)=>e+u(t),0),l=(e,t,n)=>{let a=(0,i.F)(e),u=(0,r.useMemo)(()=>n.map(e=>e.extracted_content).join(" "),[n]);return a+(0,i.F)(u)+o(t)},d=(e,t)=>e/t>.4},33703:(e,t,n)=>{n.d(t,{Fo:()=>d,HP:()=>s,Zi:()=>c});var i=n(77186),r=n(1761),a=n(29585),u=n(71473),o=n(87606),l=n(81527);let d=(e,t)=>{let{account:n,activeOrganization:a}=(0,r.YL)(),d=t===(null==n?void 0:n.uuid),s=null==a?void 0:a.uuid,c=(0,o.useQueryClient)(),v=(0,l.Gz)();return(0,i.L2)(()=>"/api/organizations/".concat(s,"/projects/").concat(e,"/accounts/").concat(t),"PUT",{onSuccess:()=>{c.invalidateQueries({queryKey:[u.vE,{projectUuid:e}]}),d&&(v(e),c.invalidateQueries({queryKey:[u.A2,{orgUUID:s}]}),c.invalidateQueries({queryKey:[u.DC,{orgUUID:s}]}),c.invalidateQueries({queryKey:[u.Ad,{orgUUID:s}]}))}})},s=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,r.YL)(),o=null==n?void 0:n.uuid;return(0,i.Sk)("/api/organizations/".concat(o,"/projects/").concat(e,"/accounts"),{queryKey:[u.vE,{projectUuid:e}],enabled:!!(t&&n&&e),staleTime:0,meta:{noToast:e=>e instanceof a.LG&&403===e.statusCode}})},c=e=>{let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,a=(0,o.useQueryClient)();return(0,i.L2)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/accounts_bulk"),"POST",{onSuccess(){a.invalidateQueries({queryKey:[u.vE,{projectUuid:e}]})}})}},41932:(e,t,n)=>{n.d(t,{Aw:()=>v,KU:()=>p,MO:()=>l,Rn:()=>d,fh:()=>s,gG:()=>c,uE:()=>y});var i=n(77186),r=n(1761),a=n(29585),u=n(71473),o=n(87606);function l(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,r.YL)(),a=null==n?void 0:n.uuid,{data:o,...l}=(0,i.Sk)("/api/organizations/".concat(a,"/projects/").concat(e,"/docs"),{queryKey:[u.cC,{orgUuid:a,projectUuid:e}],enabled:!!n&&!!e&&t});return{data:null==o?void 0:o.filter(e=>{let{file_name:t,content:n}=e;return t.length>0&&n.length>0}).filter(e=>{let{file_name:t}=e;return"[ANT ONLY] synced_resources.txt"!==t}),unfilteredData:o,...l}}let d=e=>{let{projectUuid:t,docUuid:n}=e,{activeOrganization:o}=(0,r.YL)(),l=null==o?void 0:o.uuid;return(0,i.Sk)("/api/organizations/".concat(l,"/projects/").concat(t,"/docs/").concat(n),{queryKey:[u.Db,{orgUuid:l,projectUuid:t,docUuid:n}],enabled:!!o,staleTime:0,meta:{noToast:e=>e instanceof a.LG&&404===e.statusCode}})};function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,r.YL)(),a=null==n?void 0:n.uuid,l=(0,o.useQueryClient)();return(0,i.L2)(()=>"/api/organizations/".concat(a,"/projects/").concat(e,"/docs"),"POST",{enabled:!!e,onSuccess:function(){for(var n,i=arguments.length,r=Array(i),o=0;o<i;o++)r[o]=arguments[o];l.invalidateQueries({queryKey:[u.cC,{orgUuid:a,projectUuid:e}]}),l.invalidateQueries({queryKey:[u.A2,{orgUUID:a}]}),l.invalidateQueries({queryKey:[u.qz,{orgUuid:a,projectUuid:e}]}),null==(n=t.onSuccess)||n.call(t,...r)},onError:function(){for(var e,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];null==(e=t.onError)||e.call(t,...i)}})}function c(e){let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,a=(0,o.useQueryClient)();return(0,i.Qv)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/docs/").concat(t.docUuid),"DELETE",(e,t)=>t?t.filter(t=>t.uuid!==e.docUuid):t,{queryKey:[u.cC,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:(t,i)=>{a.invalidateQueries({queryKey:[u.Db,{orgUuid:n,projectUuid:e,docUuid:i.docUuid}]}),a.invalidateQueries({queryKey:[u.A2,{orgUUID:n}]}),a.invalidateQueries({queryKey:[u.qz,{orgUuid:n,projectUuid:e}]})},onError:()=>{a.invalidateQueries({queryKey:[u.cC,{orgUuid:n,projectUuid:e}]})}})}let v=e=>{let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,a=(0,o.useQueryClient)();return(0,i.Qv)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/docs/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.doc_uuids.includes(t.uuid)):t,{queryKey:[u.cC,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:(t,i)=>{for(let t of i.doc_uuids)a.invalidateQueries({queryKey:[u.Db,{orgUuid:n,projectUuid:e,docUuid:t}]});a.invalidateQueries({queryKey:[u.cC,{orgUuid:n,projectUuid:e}]}),a.invalidateQueries({queryKey:[u.A2,{orgUUID:n}]}),a.invalidateQueries({queryKey:[u.qz,{orgUuid:n,projectUuid:e}]})}})};function p(e){let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,a=(0,o.useQueryClient)();return(0,i.Qv)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/files/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.file_uuids.includes(t.file_uuid)):t,{queryKey:[u.mw,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:()=>{a.invalidateQueries({queryKey:[u.A2,{orgUUID:n}]}),a.invalidateQueries({queryKey:[u.qz,{orgUuid:n,projectUuid:e}]})},onError:()=>{a.invalidateQueries({queryKey:[u.mw,{orgUuid:n,projectUuid:e}]})}})}function y(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,r.YL)(),a=null==n?void 0:n.uuid;return(0,i.Sk)("/api/organizations/".concat(a,"/projects/").concat(e,"/files"),{queryKey:[u.mw,{orgUuid:a,projectUuid:e}],enabled:!!n&&!!e&&t})}},56147:(e,t,n)=>{n.d(t,{AO:()=>Q,AV:()=>z,ED:()=>T,Pb:()=>C,RP:()=>q,aT:()=>j,gq:()=>k,pb:()=>E,ti:()=>P});var i=n(85644),r=n(96784),a=n(1761),u=n(55554),o=n(46612),l=n(27062),d=n(77101),s=n(85544),c=n(7620),v=n(75006),p=n(98251),y=n(33703),f=n(41932),m=n(52909),g=n(81527),_=n(6568),L=n(80731);let S={hardLimit:1e5},h={default:{max:S,raven:S,pro:S,free:S}},b=v.z.object({hardLimit:v.z.number().optional(),tokensPerImage:v.z.number().optional()}),K=v.z.object({free:b.optional(),pro:b.optional(),raven:b.optional(),max:b.optional()}),q=v.z.record(K.optional()),j=()=>{let{data:e}=(0,g.PL)(),t=(0,L.p)();return void 0!==t&&void 0!==e&&e.count>=t},z=()=>{let{value:e}=(0,l.fS)("claude_ai_project_bananagrams");return e},C=e=>{let t=z(),{data:n}=(0,p.fR)(e,t);return!!t&&(void 0!==n?!!(t&&n.use_project_knowledge_search):void 0)},Q=()=>{let e=(0,a.mV)(),t=(0,a.O9)(),n=(0,a.zc)(),{selectedTier:r,shouldOverrideTokenLimits:o,isTierSelectorEnabled:d}=(0,u.t)(),c=d&&o&&!!r,v=(0,l.T9)("console_default_model","model",null,l.Lu),{activeModelOptions:p}=(0,i.A9)(),y=p.map(e=>e.model),f=(0,l.iW)("hatch_token_limits",h,q),m=z(),g=(0,l.T9)("project_knowledge_limit","limit",0x3200000,l.T2);if(m)return{maxKbTokens:g,modelWithLargestContext:null};let _=null,L=-1/0;for(let i of Object.keys(f)){var S,b,K,j,C,Q,T,k,E,P,U,w,R,Y,D,O;let a,u;if(!y.includes(i)&&"default"!==i)continue;let o=f[i];(c?r===s.d7.MAX:n)?(a=null!=(K=null==o||null==(S=o.max)?void 0:S.hardLimit)?K:19e4,u=null!=(j=null==o||null==(b=o.max)?void 0:b.output)?j:8192):(c?r===s.d7.ENTERPRISE:e)?(a=null!=(T=null==o||null==(C=o.raven)?void 0:C.hardLimit)?T:19e4,u=null!=(k=null==o||null==(Q=o.raven)?void 0:Q.output)?k:8192):(c?r===s.d7.PRO:t)?(a=null!=(U=null==o||null==(E=o.pro)?void 0:E.hardLimit)?U:19e4,u=null!=(w=null==o||null==(P=o.pro)?void 0:P.output)?w:8192):(a=null!=(D=null==o||null==(R=o.free)?void 0:R.hardLimit)?D:25e3,u=null!=(O=null==o||null==(Y=o.free)?void 0:Y.output)?O:8192),(a=Math.round(.9*a)-u)>L?(_="default"===i?v:i,L=a):a===L&&"default"===i&&(_=v)}return{maxKbTokens:L,modelWithLargestContext:_}},T=e=>{let t=z(),{data:n,isLoading:i}=(0,f.MO)(e,!1===t),{data:a,isLoading:u}=(0,m.CO)(e,!0,!1===t),{data:l,isLoading:s}=(0,f.uE)(e,!1===t),{data:v,isLoading:y}=(0,p.fR)(e,t),g=null==l?void 0:l.filter(e=>"document"===e.file_kind),L=(0,c.useMemo)(()=>{var e;return null!=(e=null==g?void 0:g.reduce((e,t)=>e+(0,_.n2)(t),0))?e:0},[g]),S=null==l?void 0:l.filter(e=>"image"===e.file_kind),h=(0,c.useMemo)(()=>{var e;return null!=(e=null==S?void 0:S.reduce((e,t)=>e+(0,_.SL)(t),0))?e:0},[S]),b=(0,c.useMemo)(()=>(n||[]).map(e=>e.content).join(" "),[n]),K=(0,r.F)(b,{skip:null==t||t})+L+h,q=(0,c.useMemo)(()=>{var e,t;let n=null==a?void 0:a.filter(e=>e.type===d.v8.GITHUB),i=null==a?void 0:a.filter(e=>e.type!==d.v8.GITHUB),r=null!=(e=null==n?void 0:n.map(e=>e.status.current_size_bytes).filter(e=>!!e&&"number"==typeof e).reduce((e,t)=>e+t,0))?e:0,u=null!=(t=null==i?void 0:i.map(e=>e.status.current_size_bytes).filter(e=>!!e&&"number"==typeof e).reduce((e,t)=>e+t,0))?t:0;return Math.floor(r/o.Pu+u/o.t2)},[a]);if(!i&&!u&&!s&&!y){if(t){var j;return null!=(j=null==v?void 0:v.knowledge_size)?j:0}return void 0!==n?void 0!==a?K+q:K:void 0!==a?q:void 0}},k=e=>{let t=z(),{data:n}=(0,p.fR)(e,t);if(n)return n.project_knowledge_search_threshold},E=e=>{let{mutate:t}=(0,g.sS)(e),{data:n}=(0,g.fo)(e);return()=>{t({is_starred:!(null==n?void 0:n.is_starred)})}},P=e=>{var t;let{projectUuid:n}=e,{account:i}=(0,a.YL)(),{data:r}=(0,g.fo)(n),{data:u}=(0,y.HP)(n),o=(null==u||null==(t=u.find(e=>e.account.uuid===(null==i?void 0:i.uuid)))?void 0:t.role)||"none",l=(null==r?void 0:r.creator.uuid)===(null==i?void 0:i.uuid),d=(null==u?void 0:u.some(e=>"none"!==e.role&&e.account.uuid!==(null==r?void 0:r.creator.uuid)))||(null==r?void 0:r.is_private)===!1,s=!(null==r?void 0:r.is_private)&&(null==r?void 0:r.organization_role)==="user",c=!(null==r?void 0:r.is_private)&&(null==r?void 0:r.organization_role)==="user";return{isCreator:l,isProjectShared:d,hasKBEditPermissions:"user"===o||s,canManageMembers:"user"===o||c}}},80731:(e,t,n)=>{n.d(t,{K:()=>o,p:()=>l});var i=n(1761),r=n(55554),a=n(85544),u=n(21036);let o=()=>{let e=(0,i.O9)(),t=(0,i.zc)(),n=(0,i.mV)(),{selectedTier:o,shouldOverrideFeatureAccess:l,isTierSelectorEnabled:d}=(0,r.t)(),s=(0,u.useDynamicConfig)("claude_ai_projects_limits").get("max_free_projects",0)>0,c=d&&l&&o?o===a.d7.PRO||o===a.d7.MAX||o===a.d7.ENTERPRISE:e||t||n,v=(0,u.useLayer)("trials_freemium").get("free_project",!1);return s||c||v},l=()=>{let e=(0,i.O9)(),t=(0,i.zc)(),n=(0,i.mV)(),{selectedTier:o,shouldOverrideFeatureAccess:l,isTierSelectorEnabled:d}=(0,r.t)(),s=(0,u.useDynamicConfig)("claude_ai_projects_limits"),c=(0,u.useLayer)("trials_freemium");if(d&&l&&o?o===a.d7.PRO||o===a.d7.MAX||o===a.d7.ENTERPRISE:e||t||n)return;let v=s.get("max_free_projects",0);return v>0?v:+!!c.get("free_project",!1)}},81527:(e,t,n)=>{n.d(t,{BN:()=>j,CB:()=>m,GQ:()=>C,Gz:()=>z,Kf:()=>_,LQ:()=>q,PL:()=>f,bL:()=>h,bs:()=>L,dx:()=>v,eW:()=>K,fo:()=>S,gM:()=>p,gr:()=>y,sC:()=>c,sS:()=>b,u7:()=>g});var i=n(7726),r=n(77186),a=n(1761),u=n(29585),o=n(71473),l=n(87606),d=n(7620),s=n(80731);let c=30,v=1e4;var p=function(e){return e.Student="student",e.Beam="beam",e}({}),y=function(e){return e.Study="study",e.Career="career",e.Research="research",e.BeamTemplateAskClaudeV1="beam_template_ask_claude_v1",e.BeamTemplatePmV1="beam_template_pm_v1",e.BeamTemplateDsV1="beam_template_ds_v1",e}({});let f=()=>{let{activeOrganization:e}=(0,a.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/projects/count"),{queryKey:[o.Wy,{orgUUID:t}],staleTime:3e5,enabled:!!t,meta:{noToast:e=>e instanceof u.LG&&"permission_error"===e.type}})},m=e=>{let{enabled:t=!0,limit:n,offset:i,starred:u,creatorFilter:l,isBeam:d,projectFilter:c,orderBy:v}=e,{activeOrganization:p}=(0,a.YL)(),y=(0,s.K)(),f=null==p?void 0:p.uuid,m=new URLSearchParams;return m.append("include_harmony_projects","true"),void 0!==n&&m.append("limit",n.toString()),void 0!==i&&m.append("offset",i.toString()),void 0!==u&&m.append("starred",u.toString()),void 0!==l&&m.append("creator_filter",l.toString()),void 0!==d&&m.append("is_beam",d.toString()),void 0!==c&&m.append("filter",c.toString()),void 0!==v&&m.append("order_by",v.toString()),(0,r.Sk)("/api/organizations/".concat(f,"/projects?").concat(m.toString()),{queryKey:[o.BP,{orgUuid:f},{limit:n,offset:i,starred:u,creatorFilter:l,projectFilter:c,isBeam:d,orderBy:v}],enabled:!!(t&&p&&y),select:e=>{let t=e.length===n;return Object.assign(e.filter(e=>!e.archived_at),{hasMore:t})}})},g=e=>{let{enabled:t=!0,limit:n=c,offset:i=0,starred:u,creatorFilter:l,isBeam:d,projectFilter:v,orderBy:p,searchQuery:y}=e,{activeOrganization:f}=(0,a.YL)(),m=(0,s.K)(),g=null==f?void 0:f.uuid,_=new URLSearchParams;return _.append("limit",n.toString()),_.append("offset",i.toString()),void 0!==u&&_.append("starred",u.toString()),void 0!==l&&_.append("creator_filter",l.toString()),void 0!==d&&_.append("is_beam",d.toString()),void 0!==v&&_.append("filter",v.toString()),void 0!==p&&_.append("order_by",p.toString()),void 0!==y&&_.append("searchQuery",y.toString()),(0,r.Sk)("/api/organizations/".concat(g,"/projects_v2?").concat(_.toString()),{queryKey:[o.Wf,{orgUuid:g},{limit:n,offset:i,starred:u,creatorFilter:l,projectFilter:v,isBeam:d,orderBy:p,searchQuery:y}],enabled:!!(t&&f&&m)})},_=()=>{let{activeOrganization:e}=(0,a.YL)(),t=(0,r.mn)();return(0,d.useCallback)(async()=>(await t("/api/organizations/".concat(null==e?void 0:e.uuid,"/projects"))).json(),[null==e?void 0:e.uuid,t])},L=()=>{let e=_(),t=(0,i.uE)();return(0,d.useCallback)(async()=>{let[n,r]=await Promise.all([e(),t({limit:i.dy})]);return((e,t)=>{let n=e.map(e=>({...e,lastConversation:null==t?void 0:t.find(t=>t.project_uuid===e.uuid)})).filter(e=>e.lastConversation).sort((e,t)=>new Date(t.lastConversation.created_at).getTime()-new Date(e.lastConversation.created_at).getTime()),i=null==e?void 0:e.filter(e=>!n.find(t=>t.uuid===e.uuid));return[...n,...i]})(n,r)},[t,e])},S=e=>{let{activeOrganization:t}=(0,a.YL)(),n=null==t?void 0:t.uuid;return(0,r.Sk)("/api/organizations/".concat(n,"/projects/").concat(e),{queryKey:[o.hc,{orgUuid:n,projectUuid:e}],enabled:!!(t&&e),staleTime:0,meta:{noToast:e=>e instanceof u.LG&&(404===e.statusCode||403===e.statusCode)}})},h=()=>{let{activeOrganization:e}=(0,a.YL)(),t=null==e?void 0:e.uuid,n=(0,l.useQueryClient)();return(0,r.L2)(()=>"/api/organizations/".concat(t,"/projects"),"POST",{onSuccess:()=>{n.invalidateQueries({queryKey:[o.BP,{orgUuid:t}]})}})},b=e=>{let{activeOrganization:t}=(0,a.YL)(),n=null==t?void 0:t.uuid,i=z();return(0,r.Qv)(()=>"/api/organizations/".concat(n,"/projects/").concat(e),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{i(e)},queryKey:[o.hc,{orgUuid:n,projectUuid:e}]})},K=e=>{let{activeOrganization:t}=(0,a.YL)(),n=null==t?void 0:t.uuid,i=z();return(0,r.L2)(()=>"/api/organizations/".concat(n,"/projects/").concat(e),"DELETE",{onSuccess:()=>{i(e)}})},q=function(e){let{limit:t=30,offset:n=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:i}=(0,a.YL)(),l=null==i?void 0:i.uuid,d=new URLSearchParams;return d.append("limit",t.toString()),d.append("offset",n.toString()),(0,r.Sk)("/api/organizations/".concat(l,"/projects/").concat(e,"/conversations_v2?").concat(d.toString()),{queryKey:[o.yF,{orgUuid:l,projectUuid:e,limit:t,offset:n}],enabled:!!i,staleTime:0,meta:{noToast:e=>e instanceof u.LG&&403===e.statusCode}})},j=()=>{var e,t;let n=m({enabled:!0,creatorFilter:"is_creator",limit:v}),i=null==(t=n.data)||null==(e=t.find(e=>e.is_starter_project))?void 0:e.uuid;return{...n,data:i}},z=()=>{let{activeOrganization:e}=(0,a.YL)(),t=null==e?void 0:e.uuid,n=(0,l.useQueryClient)();return e=>{n.invalidateQueries({queryKey:[o.hc,{orgUuid:t,projectUuid:e}]}),n.invalidateQueries({queryKey:[o.BP,{orgUuid:t}]}),n.invalidateQueries({queryKey:[o.yF,{orgUuid:t,projectUuid:e}]})}},C=(e,t)=>{let n=z();return(0,r.L2)("/api/organizations/".concat(e,"/projects/").concat(t,"/report"),"POST",{enabled:!!t&&!!e,onSuccess:()=>{n(t)}})}},96784:(e,t,n)=>{n.d(t,{F:()=>a});var i=n(46612),r=n(7620);function a(e){let{skip:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[a,u]=(0,r.useState)(e.length/i.t2*.8),o=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(!t){if(!o.current){if("undefined"==typeof Worker)return;try{let e=new Worker(n.tu(new URL(n.p+n.u(3572),n.b)));e.onmessage=e=>u(e.data),o.current=e}catch(t){var e;throw(null==t||null==(e=t.toString)?void 0:e.call(t).includes("Invalid URL"))&&console.error("useTokenCounter invalid URL error hit; baseUrl = ‘".concat("file:///app/packages/chat/utils/useTokenCounter.tsx","’")),t}}return()=>{var e;null==(e=o.current)||e.terminate(),o.current=null}}},[t]),(0,r.useEffect)(()=>{o.current&&o.current.postMessage(e)},[e]),a}}}]);